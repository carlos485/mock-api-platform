---
// Navbar component
---

<div class="navbar bg-base-100 shadow-lg">
  <div class="flex-1">
    <a href="/dashboard" class="btn btn-ghost text-xl">Mock API Platform</a>
  </div>
  <div class="flex-none">
    <div class="dropdown dropdown-end">
      <div
        tabindex="0"
        role="button"
        class="btn btn-ghost btn-circle avatar placeholder"
      >
        <div class="bg-neutral text-neutral-content rounded-full w-10">
          <span id="user-avatar">U</span>
        </div>
      </div>
      <ul
        tabindex="0"
        class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"
      >
        <li><a id="profile-link">Perfil</a></li>
        <li><a id="logout-btn">Cerrar Sesi√≥n</a></li>
      </ul>
    </div>
  </div>
</div>

<script>
  import { authStore } from "@/lib/stores/auth.store";
  import { AuthService } from "@/lib/services/auth.service";

  const logoutBtn = document.getElementById("logout-btn");
  const userAvatar = document.getElementById("user-avatar");

  // Subscribe to auth state
  const unsubscribe = authStore.subscribe((state) => {
    if (state.user && userAvatar) {
      const initial =
        state.user.displayName?.[0] || state.user.email?.[0] || "U";
      userAvatar.textContent = initial.toUpperCase();
    }
  });

  // Handle logout
  logoutBtn?.addEventListener("click", async (e) => {
    e.preventDefault();
    try {
      await AuthService.logout();
      window.location.href = "/login";
    } catch (error) {
      console.error("Error logging out:", error);
    }
  });

  // Cleanup
  window.addEventListener("beforeunload", () => {
    unsubscribe();
  });
</script>
